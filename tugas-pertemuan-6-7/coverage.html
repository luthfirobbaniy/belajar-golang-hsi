
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>docs: Go Coverage Report</title>
		<style>
			body {
				background: black;
				color: rgb(80, 80, 80);
			}
			body, pre, #legend span {
				font-family: Menlo, monospace;
				font-weight: bold;
			}
			#topbar {
				background: black;
				position: fixed;
				top: 0; left: 0; right: 0;
				height: 42px;
				border-bottom: 1px solid rgb(80, 80, 80);
			}
			#content {
				margin-top: 50px;
			}
			#nav, #legend {
				float: left;
				margin-left: 10px;
			}
			#legend {
				margin-top: 12px;
			}
			#nav {
				margin-top: 10px;
			}
			#legend span {
				margin: 0 5px;
			}
			.cov0 { color: rgb(192, 0, 0) }
.cov1 { color: rgb(128, 128, 128) }
.cov2 { color: rgb(116, 140, 131) }
.cov3 { color: rgb(104, 152, 134) }
.cov4 { color: rgb(92, 164, 137) }
.cov5 { color: rgb(80, 176, 140) }
.cov6 { color: rgb(68, 188, 143) }
.cov7 { color: rgb(56, 200, 146) }
.cov8 { color: rgb(44, 212, 149) }
.cov9 { color: rgb(32, 224, 152) }
.cov10 { color: rgb(20, 236, 155) }

		</style>
	</head>
	<body>
		<div id="topbar">
			<div id="nav">
				<select id="files">
				
				<option value="file0">tugas-pertemuan-7/docs/docs.go (0.0%)</option>
				
				<option value="file1">tugas-pertemuan-7/handlers/auth.go (44.4%)</option>
				
				<option value="file2">tugas-pertemuan-7/handlers/profile.go (0.0%)</option>
				
				<option value="file3">tugas-pertemuan-7/handlers/student.go (0.0%)</option>
				
				<option value="file4">tugas-pertemuan-7/main.go (0.0%)</option>
				
				<option value="file5">tugas-pertemuan-7/middleware/jwt.go (0.0%)</option>
				
				<option value="file6">tugas-pertemuan-7/tests/main.go (0.0%)</option>
				
				<option value="file7">tugas-pertemuan-7/utils/jwt.go (92.9%)</option>
				
				<option value="file8">tugas-pertemuan-7/utils/validation.go (100.0%)</option>
				
				</select>
			</div>
			<div id="legend">
				<span>not tracked</span>
			
				<span class="cov0">not covered</span>
				<span class="cov8">covered</span>
			
			</div>
		</div>
		<div id="content">
		
		<pre class="file" id="file0" style="display: none">// Package docs Code generated by swaggo/swag. DO NOT EDIT
package docs

import "github.com/swaggo/swag"

const docTemplate = `{
    "schemes": {{ marshal .Schemes }},
    "swagger": "2.0",
    "info": {
        "description": "{{escape .Description}}",
        "title": "{{.Title}}",
        "contact": {},
        "version": "{{.Version}}"
    },
    "host": "{{.Host}}",
    "basePath": "{{.BasePath}}",
    "paths": {
        "/auth/login": {
            "post": {
                "description": "Authenticate user with static credentials and return JWT token",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Authentication"
                ],
                "summary": "User login",
                "parameters": [
                    {
                        "description": "Login credentials",
                        "name": "credentials",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/models.LoginRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Login successful",
                        "schema": {
                            "$ref": "#/definitions/models.LoginResponse"
                        }
                    },
                    "400": {
                        "description": "Invalid request body",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "401": {
                        "description": "Invalid credentials",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Failed to generate token",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/auth/register": {
            "post": {
                "description": "Register new user and return JWT token for auto login",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Authentication"
                ],
                "summary": "User register",
                "parameters": [
                    {
                        "description": "Register credentials",
                        "name": "credentials",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/models.RegisterRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Register successful",
                        "schema": {
                            "$ref": "#/definitions/models.RegisterResponse"
                        }
                    },
                    "400": {
                        "description": "Invalid request body",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "401": {
                        "description": "Invalid credentials",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Failed to generate token",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/profile": {
            "get": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Get profile",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Profile"
                ],
                "summary": "Get profile",
                "responses": {
                    "200": {
                        "description": "Get profile successful",
                        "schema": {
                            "$ref": "#/definitions/models.GetProfileResponse"
                        }
                    },
                    "401": {
                        "description": "Invalid credentials",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/students": {
            "get": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Get all student data",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Students"
                ],
                "summary": "Get all student",
                "responses": {
                    "200": {
                        "description": "Get students successful",
                        "schema": {
                            "$ref": "#/definitions/models.GetStudentsResponse"
                        }
                    },
                    "401": {
                        "description": "Authorization header required or Invalid token",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            },
            "post": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Create student",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Students"
                ],
                "summary": "Create student",
                "parameters": [
                    {
                        "description": "Create student data",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/models.CreateStudentRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Create student successful",
                        "schema": {
                            "$ref": "#/definitions/models.CreateStudentResponse"
                        }
                    },
                    "400": {
                        "description": "Invalid request body",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "401": {
                        "description": "Invalid credentials",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/students/{id}": {
            "get": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Get one student data",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Students"
                ],
                "summary": "Get one student",
                "parameters": [
                    {
                        "type": "integer",
                        "description": "Student id",
                        "name": "id",
                        "in": "path",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Get student successful",
                        "schema": {
                            "$ref": "#/definitions/models.GetStudentResponse"
                        }
                    },
                    "400": {
                        "description": "Missing parameter",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "401": {
                        "description": "Authorization header required or Invalid token",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "404": {
                        "description": "Student not found",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            },
            "put": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Update student",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Students"
                ],
                "summary": "Update student",
                "parameters": [
                    {
                        "type": "integer",
                        "description": "Student id",
                        "name": "id",
                        "in": "path",
                        "required": true
                    },
                    {
                        "description": "Update student data",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/models.UpdateStudentRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Update student successful",
                        "schema": {
                            "$ref": "#/definitions/models.UpdateStudentResponse"
                        }
                    },
                    "400": {
                        "description": "Invalid request body",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "401": {
                        "description": "Invalid credentials",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "404": {
                        "description": "Student not found",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            },
            "delete": {
                "security": [
                    {
                        "BearerAuth": []
                    }
                ],
                "description": "Delete student",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "Students"
                ],
                "summary": "Delete student",
                "parameters": [
                    {
                        "type": "integer",
                        "description": "Student id",
                        "name": "id",
                        "in": "path",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Update student successful",
                        "schema": {
                            "$ref": "#/definitions/models.DeleteStudentResponse"
                        }
                    },
                    "401": {
                        "description": "Invalid credentials",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    },
                    "404": {
                        "description": "Student not found",
                        "schema": {
                            "$ref": "#/definitions/models.ErrorResponse"
                        }
                    }
                }
            }
        }
    },
    "definitions": {
        "models.CreateStudentRequest": {
            "description": "Create student request",
            "type": "object",
            "properties": {
                "email": {
                    "type": "string",
                    "example": "budi@example.com"
                },
                "major": {
                    "type": "string",
                    "example": "Teknik Industri"
                },
                "name": {
                    "type": "string",
                    "example": "Budi"
                },
                "nim": {
                    "type": "string",
                    "example": "2021003"
                },
                "semester": {
                    "type": "integer",
                    "example": 2
                }
            }
        },
        "models.CreateStudentResponse": {
            "description": "Create student response",
            "type": "object",
            "properties": {
                "data": {
                    "$ref": "#/definitions/models.Student"
                },
                "message": {
                    "type": "string",
                    "example": "Create student success!"
                },
                "success": {
                    "type": "boolean",
                    "example": true
                }
            }
        },
        "models.DeleteStudentResponse": {
            "description": "Delete student response",
            "type": "object",
            "properties": {
                "data": {
                    "$ref": "#/definitions/models.Student"
                },
                "message": {
                    "type": "string",
                    "example": "Delete student success!"
                },
                "success": {
                    "type": "boolean",
                    "example": true
                }
            }
        },
        "models.ErrorResponse": {
            "description": "Error response",
            "type": "object",
            "properties": {
                "message": {
                    "type": "string",
                    "example": "Invalid request body"
                },
                "success": {
                    "type": "boolean",
                    "example": false
                }
            }
        },
        "models.GetProfileResponse": {
            "description": "Get profile response",
            "type": "object",
            "properties": {
                "data": {
                    "$ref": "#/definitions/models.ProfileData"
                },
                "message": {
                    "type": "string",
                    "example": "Get profile success!"
                },
                "success": {
                    "type": "boolean",
                    "example": true
                }
            }
        },
        "models.GetStudentResponse": {
            "description": "Get student response",
            "type": "object",
            "properties": {
                "data": {
                    "$ref": "#/definitions/models.Student"
                },
                "message": {
                    "type": "string",
                    "example": "Get student successful!"
                },
                "success": {
                    "type": "boolean",
                    "example": true
                }
            }
        },
        "models.GetStudentsResponse": {
            "description": "Get students response",
            "type": "object",
            "properties": {
                "data": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/models.Student"
                    }
                },
                "message": {
                    "type": "string",
                    "example": "Get students successful!"
                },
                "success": {
                    "type": "boolean",
                    "example": true
                }
            }
        },
        "models.LoginData": {
            "description": "Login response data",
            "type": "object",
            "properties": {
                "token": {
                    "type": "string",
                    "example": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6Imx1dGhmaSIsImV4cCI6MTc1NTMzMTU5NiwiaWF0IjoxNzU1MjQ1MTk2fQ.7WktpMm0AyyfXUR5x68Om7Pps9uR1resDlh2bz9C_J8"
                }
            }
        },
        "models.LoginRequest": {
            "description": "Login request payload",
            "type": "object",
            "properties": {
                "password": {
                    "type": "string",
                    "example": "123"
                },
                "username": {
                    "type": "string",
                    "example": "luthfi"
                }
            }
        },
        "models.LoginResponse": {
            "description": "Login response",
            "type": "object",
            "properties": {
                "data": {
                    "$ref": "#/definitions/models.LoginData"
                },
                "message": {
                    "type": "string",
                    "example": "Login successful!"
                },
                "success": {
                    "type": "boolean",
                    "example": true
                }
            }
        },
        "models.ProfileData": {
            "description": "Get profile response data",
            "type": "object",
            "properties": {
                "id": {
                    "type": "integer"
                },
                "role": {
                    "type": "string"
                },
                "username": {
                    "type": "string"
                }
            }
        },
        "models.RegisterRequest": {
            "description": "Register response data",
            "type": "object",
            "properties": {
                "password": {
                    "type": "string",
                    "example": "123"
                },
                "username": {
                    "type": "string",
                    "example": "luthfi"
                }
            }
        },
        "models.RegisterResponse": {
            "description": "Register response data",
            "type": "object",
            "properties": {
                "data": {
                    "$ref": "#/definitions/models.LoginData"
                },
                "message": {
                    "type": "string",
                    "example": "Login successful!"
                },
                "success": {
                    "type": "boolean",
                    "example": true
                }
            }
        },
        "models.Student": {
            "type": "object",
            "properties": {
                "email": {
                    "type": "string",
                    "example": "luthfi@example.com"
                },
                "id": {
                    "type": "integer",
                    "example": 1
                },
                "major": {
                    "type": "string",
                    "example": "Computer Science"
                },
                "name": {
                    "type": "string",
                    "example": "Luthfi"
                },
                "nim": {
                    "type": "string",
                    "example": "2021001"
                },
                "semester": {
                    "type": "integer",
                    "example": 1
                }
            }
        },
        "models.UpdateStudentRequest": {
            "description": "Update student request",
            "type": "object",
            "properties": {
                "email": {
                    "type": "string",
                    "example": "luthfi@example.com"
                },
                "major": {
                    "type": "string",
                    "example": "Computer Science"
                },
                "name": {
                    "type": "string",
                    "example": "Luthfi Edited"
                },
                "nim": {
                    "type": "string",
                    "example": "2021001"
                },
                "semester": {
                    "type": "integer",
                    "example": 1
                }
            }
        },
        "models.UpdateStudentResponse": {
            "description": "Update student response",
            "type": "object",
            "properties": {
                "data": {
                    "$ref": "#/definitions/models.Student"
                },
                "message": {
                    "type": "string",
                    "example": "Update student success!"
                },
                "success": {
                    "type": "boolean",
                    "example": true
                }
            }
        }
    },
    "securityDefinitions": {
        "BearerAuth": {
            "description": "Type \"Bearer\" followed by a space and JWT token.",
            "type": "apiKey",
            "name": "Authorization",
            "in": "header"
        }
    }
}`

// SwaggerInfo holds exported Swagger Info so clients can modify it
var SwaggerInfo = &amp;swag.Spec{
        Version:          "1.0",
        Host:             "localhost:3000",
        BasePath:         "/api",
        Schemes:          []string{"http"},
        Title:            "Sistem Manajemen Mahasiswa",
        Description:      "Sistem manajemen mahasiswa using Go Fiber",
        InfoInstanceName: "swagger",
        SwaggerTemplate:  docTemplate,
        LeftDelim:        "{{",
        RightDelim:       "}}",
}

func init() <span class="cov0" title="0">{
        swag.Register(SwaggerInfo.InstanceName(), SwaggerInfo)
}</span>
</pre>
		
		<pre class="file" id="file1" style="display: none">package handlers

import (
        "tugas-pertemuan-7/models"
        "tugas-pertemuan-7/utils"

        "github.com/gofiber/fiber/v2"

        _ "tugas-pertemuan-7/docs"
)

var users = []models.User{
        {
                ID:       1,
                Username: "admin",
                Password: "admin123",
                Role:     "admin",
        },
        {
                ID:       2,
                Username: "student1",
                Password: "student123",
                Role:     "student",
        },
}

var latestUserId = 2

// login godoc
// @Summary User login
// @Description Authenticate user with static credentials and return JWT token
// @Tags Authentication
// @Accept json
// @Produce json
// @Param credentials body models.LoginRequest true "Login credentials"
// @Success 200 {object} models.LoginResponse "Login successful"
// @Failure 400 {object} models.ErrorResponse "Invalid request body"
// @Failure 401 {object} models.ErrorResponse "Invalid credentials"
// @Failure 500 {object} models.ErrorResponse "Failed to generate token"
// @Router /auth/login [post]
func Login(c *fiber.Ctx) error <span class="cov8" title="1">{
        var body models.LoginRequest

        if err := c.BodyParser(&amp;body); err != nil </span><span class="cov0" title="0">{
                return fiber.NewError(fiber.StatusBadRequest, "Invalid request body!")
        }</span>

        <span class="cov8" title="1">var user models.User

        // Find user
        for _, u := range users </span><span class="cov8" title="1">{
                if body.Username == u.Username &amp;&amp; body.Password == u.Password </span><span class="cov8" title="1">{
                        user = u
                        break</span>
                }
        }

        // If user not found
        <span class="cov8" title="1">if user.ID == 0 </span><span class="cov8" title="1">{
                return fiber.NewError(fiber.StatusBadRequest, "Invalid credentials!")
        }</span>

        <span class="cov8" title="1">tokenString, err := utils.CreateJwt(&amp;user)

        if err != nil </span><span class="cov0" title="0">{
                return fiber.NewError(fiber.StatusInternalServerError, "Failed to generate token!")
        }</span>

        <span class="cov8" title="1">return c.JSON(models.LoginResponse{
                Success: true,
                Message: "Login successful!",
                Data: models.LoginData{
                        Token: tokenString,
                },
        })</span>
}

// register godoc
// @Summary User register
// @Description Register new user and return JWT token for auto login
// @Tags Authentication
// @Accept json
// @Produce json
// @Param credentials body models.RegisterRequest true "Register credentials"
// @Success 200 {object} models.RegisterResponse "Register successful"
// @Failure 400 {object} models.ErrorResponse "Invalid request body"
// @Failure 401 {object} models.ErrorResponse "Invalid credentials"
// @Failure 500 {object} models.ErrorResponse "Failed to generate token"
// @Router /auth/register [post]
func Register(c *fiber.Ctx) error <span class="cov0" title="0">{
        var body models.RegisterRequest

        if err := c.BodyParser(&amp;body); err != nil </span><span class="cov0" title="0">{
                return fiber.NewError(fiber.StatusBadRequest, "Invalid request body!")
        }</span>

        // Validate username with registered usernames
        <span class="cov0" title="0">for _, u := range users </span><span class="cov0" title="0">{
                if body.Username == u.Username </span><span class="cov0" title="0">{
                        return fiber.NewError(fiber.StatusBadRequest, "Username has already exist!")
                }</span>
        }

        <span class="cov0" title="0">latestUserId += 1

        newUser := models.User{
                ID:       latestUserId,
                Username: body.Username,
                Password: body.Password,
                Role:     "student", // Only accept "user" role for registration
        }

        // Store new user to db
        users = append(users, newUser)

        tokenString, err := utils.CreateJwt(&amp;newUser)

        if err != nil </span><span class="cov0" title="0">{
                return fiber.NewError(fiber.StatusInternalServerError, "Failed to generate token!")
        }</span>

        <span class="cov0" title="0">return c.Status(201).JSON(models.RegisterResponse{
                Success: true,
                Message: "Register successful!",
                Data: models.LoginData{
                        Token: tokenString,
                },
        })</span>
}
</pre>
		
		<pre class="file" id="file2" style="display: none">package handlers

import (
        "tugas-pertemuan-7/models"

        "github.com/gofiber/fiber/v2"

        _ "tugas-pertemuan-7/docs"
)

// GetProfile godoc
// @Summary Get profile
// @Description Get profile
// @Tags Profile
// @Accept json
// @Produce json
// @Security BearerAuth
// @Success 200 {object} models.GetProfileResponse "Get profile successful"
// @Failure 401 {object} models.ErrorResponse "Invalid credentials"
// @Router /profile [get]
func GetProfile(c *fiber.Ctx) error <span class="cov0" title="0">{
        id := c.Locals("id")

        var user models.User

        // Find profile
        for _, u := range users </span><span class="cov0" title="0">{
                if u.ID == id </span><span class="cov0" title="0">{
                        user = u
                }</span>
        }

        <span class="cov0" title="0">return c.JSON(models.GetProfileResponse{
                Success: true,
                Message: "Get profile success!",
                Data: models.ProfileData{
                        ID:       user.ID,
                        Username: user.Username,
                        Role:     user.Role,
                },
        })</span>
}
</pre>
		
		<pre class="file" id="file3" style="display: none">package handlers

import (
        "strconv"

        "github.com/gofiber/fiber/v2"

        _ "tugas-pertemuan-7/docs"
        "tugas-pertemuan-7/models"
        "tugas-pertemuan-7/utils"
)

var students = []models.Student{
        {
                ID:       1,
                NIM:      "2021001",
                Name:     "Luthfi",
                Email:    "luthfi@example.com",
                Major:    "Computer Science",
                Semester: 1,
        },
        {
                ID:       2,
                NIM:      "2021002",
                Name:     "Ahmad",
                Email:    "ahmad@example.com",
                Major:    "Electrical Engineering",
                Semester: 1,
        },
}

var latestStudentId = 2

// getStudents godoc
// @Summary Get all student
// @Description Get all student data
// @Tags Students
// @Accept json
// @Produce json
// @Security BearerAuth
// @Success 200 {object} models.GetStudentsResponse "Get students successful"
// @Failure 401 {object} models.ErrorResponse "Authorization header required or Invalid token"
// @Router /students [get]
func GetStudents(c *fiber.Ctx) error <span class="cov0" title="0">{
        return c.JSON(models.GetStudentsResponse{
                Success: true,
                Message: "Get students successful!",
                Data:    students,
        })
}</span>

// getStudent godoc
// @Summary Get one student
// @Description Get one student data
// @Tags Students
// @Accept json
// @Produce json
// @Security BearerAuth
// @Param id path int true "Student id"
// @Success 200 {object} models.GetStudentResponse "Get student successful"
// @Failure 400 {object} models.ErrorResponse "Missing parameter"
// @Failure 401 {object} models.ErrorResponse "Authorization header required or Invalid token"
// @Failure 404 {object} models.ErrorResponse "Student not found"
// @Router /students/{id} [get]
func GetStudent(c *fiber.Ctx) error <span class="cov0" title="0">{
        if c.Params("id") == "" </span><span class="cov0" title="0">{
                return fiber.NewError(fiber.StatusBadRequest, "Missing parameter!")
        }</span>

        <span class="cov0" title="0">var student models.Student
        // student := &amp;models.Student{}

        for _, s := range students </span><span class="cov0" title="0">{
                if id, _ := strconv.Atoi(c.Params("id")); s.ID == id </span><span class="cov0" title="0">{
                        student = s
                        break</span>
                }
        }

        <span class="cov0" title="0">if student.ID == 0 </span><span class="cov0" title="0">{
                return fiber.NewError(fiber.StatusNotFound, "Student not found!")
        }</span>

        <span class="cov0" title="0">return c.JSON(models.GetStudentResponse{
                Success: true,
                Message: "Get student successful!",
                Data:    student,
        })</span>
}

// createStudent godoc
// @Summary Create student
// @Description Create student
// @Tags Students
// @Accept json
// @Produce json
// @Security BearerAuth
// @Param request body models.CreateStudentRequest true "Create student data"
// @Success 200 {object} models.CreateStudentResponse "Create student successful"
// @Failure 400 {object} models.ErrorResponse "Invalid request body"
// @Failure 401 {object} models.ErrorResponse "Invalid credentials"
// @Router /students [post]
func CreateStudent(c *fiber.Ctx) error <span class="cov0" title="0">{
        var body models.CreateStudentRequest

        if err := c.BodyParser(&amp;body); err != nil </span><span class="cov0" title="0">{
                return fiber.NewError(fiber.StatusBadRequest, "Body parsing failed!")
        }</span>

        <span class="cov0" title="0">if !utils.ValidateEmail(body.Email) </span><span class="cov0" title="0">{
                return fiber.NewError(fiber.StatusBadRequest, "Invalid email!")
        }</span>

        <span class="cov0" title="0">if !utils.ValidateNIM(body.NIM) </span><span class="cov0" title="0">{
                return fiber.NewError(fiber.StatusBadRequest, "Invalid NIM!")
        }</span>

        <span class="cov0" title="0">if !utils.ValidateSemester(body.Semester) </span><span class="cov0" title="0">{
                return fiber.NewError(fiber.StatusBadRequest, "Invalid Semester!")
        }</span>

        <span class="cov0" title="0">latestStudentId += 1

        newStudent := models.Student{
                ID:       latestStudentId,
                NIM:      body.NIM,
                Name:     body.Name,
                Email:    body.Email,
                Major:    body.Major,
                Semester: body.Semester,
        }

        students = append(students, newStudent)

        return c.Status(201).JSON(models.CreateStudentResponse{
                Success: true,
                Message: "Create student success!",
                Data:    newStudent,
        })</span>
}

// updateStudent godoc
// @Summary Update student
// @Description Update student
// @Tags Students
// @Accept json
// @Produce json
// @Security BearerAuth
// @Param id path int true "Student id"
// @Param request body models.UpdateStudentRequest true "Update student data"
// @Success 200 {object} models.UpdateStudentResponse "Update student successful"
// @Failure 400 {object} models.ErrorResponse "Invalid request body"
// @Failure 401 {object} models.ErrorResponse "Invalid credentials"
// @Failure 404 {object} models.ErrorResponse "Student not found"
// @Router /students/{id} [put]
func UpdateStudent(c *fiber.Ctx) error <span class="cov0" title="0">{
        id := c.Params("id")

        if id == "" </span><span class="cov0" title="0">{
                return fiber.NewError(fiber.StatusBadRequest, "Missing parameter!")
        }</span>

        <span class="cov0" title="0">var body models.UpdateStudentRequest

        if err := c.BodyParser(&amp;body); err != nil </span><span class="cov0" title="0">{
                return fiber.NewError(fiber.StatusBadRequest, "Body parsing failed!")
        }</span>

        <span class="cov0" title="0">var student models.Student

        // Update student
        for i := 0; i &lt; len(students); i++ </span><span class="cov0" title="0">{
                s := &amp;students[i] // Biar data master bisa berubah

                if id, _ := strconv.Atoi(id); students[i].ID == id </span><span class="cov0" title="0">{
                        s.NIM = body.NIM
                        s.Name = body.Name
                        s.Email = body.Email
                        s.Major = body.Major
                        s.Semester = body.Semester

                        student = *s

                        break</span>
                }
        }

        <span class="cov0" title="0">if student.ID == 0 </span><span class="cov0" title="0">{
                return fiber.NewError(fiber.StatusNotFound, "Student not found!")
        }</span>

        <span class="cov0" title="0">return c.JSON(models.UpdateStudentResponse{
                Success: true,
                Message: "Update student success!",
                Data:    student,
        })</span>
}

// DeleteStudent godoc
// @Summary Delete student
// @Description Delete student
// @Tags Students
// @Accept json
// @Produce json
// @Security BearerAuth
// @Param id path int true "Student id"
// @Success 200 {object} models.DeleteStudentResponse "Update student successful"
// @Failure 401 {object} models.ErrorResponse "Invalid credentials"
// @Failure 404 {object} models.ErrorResponse "Student not found"
// @Router /students/{id} [delete]
func DeleteStudent(c *fiber.Ctx) error <span class="cov0" title="0">{
        id := c.Params("id")

        var student models.Student

        // Update student
        for i := 0; i &lt; len(students); i++ </span><span class="cov0" title="0">{
                if id, _ := strconv.Atoi(id); students[i].ID == id </span><span class="cov0" title="0">{
                        student = students[i]
                        students = append(students[:i], students[i+1:]...)
                        break</span>
                }
        }

        <span class="cov0" title="0">if student.ID == 0 </span><span class="cov0" title="0">{
                return fiber.NewError(fiber.StatusNotFound, "Student not found!")
        }</span>

        <span class="cov0" title="0">return c.JSON(models.DeleteStudentResponse{
                Success: true,
                Message: "Delete student success!",
                Data:    student,
        })</span>
}
</pre>
		
		<pre class="file" id="file4" style="display: none">package main

import (
        "tugas-pertemuan-7/handlers"
        "tugas-pertemuan-7/middleware"
        "tugas-pertemuan-7/models"

        "github.com/gofiber/fiber/v2"
        "github.com/gofiber/fiber/v2/middleware/cors"
        "github.com/gofiber/fiber/v2/middleware/logger"
        "github.com/gofiber/fiber/v2/middleware/recover"
        "github.com/joho/godotenv"
        fiberSwagger "github.com/swaggo/fiber-swagger"

        _ "tugas-pertemuan-7/docs"
)

// @title Sistem Manajemen Mahasiswa
// @version 1.0
// @description Sistem manajemen mahasiswa using Go Fiber
// @host localhost:3000
// @BasePath /api
// @schemes http
// @securityDefinitions.apikey BearerAuth
// @in header
// @name Authorization
// @description Type "Bearer" followed by a space and JWT token.
func main() <span class="cov0" title="0">{
        app := fiber.New(fiber.Config{
                ErrorHandler: func(c *fiber.Ctx, err error) error </span><span class="cov0" title="0">{
                        // Default: 500
                        code := fiber.StatusInternalServerError

                        if e, ok := err.(*fiber.Error); ok </span><span class="cov0" title="0">{
                                code = e.Code
                        }</span>

                        <span class="cov0" title="0">return c.Status(code).JSON(models.ErrorResponse{
                                Success: false,
                                Message: err.Error(),
                        })</span>
                },
        })

        <span class="cov0" title="0">app.Use(logger.New())
        app.Use(cors.New())
        app.Use(recover.New())

        godotenv.Load()

        // Swager
        app.Get("/swagger/*", fiberSwagger.WrapHandler)
        // app.Get("/swagger/*", swagger.HandlerDefault) // Alternative: Swagger from Fiber

        // Authentication Endpoints
        app.Post("/api/auth/login", handlers.Login)
        app.Post("/api/auth/register", handlers.Register)

        // Student Management Endpoints (Protected)
        app.Get("/api/students", middleware.Jwt, handlers.GetStudents)
        app.Get("/api/students/:id", middleware.Jwt, handlers.GetStudent)
        app.Post("/api/students", middleware.Jwt, handlers.CreateStudent)
        app.Put("/api/students/:id", middleware.Jwt, handlers.UpdateStudent)
        app.Delete("/api/students/:id", middleware.Jwt, handlers.DeleteStudent)

        // Profile Endpoint
        app.Get("/api/profile", middleware.Jwt, handlers.GetProfile)

        app.Listen(":3000")</span>
}
</pre>
		
		<pre class="file" id="file5" style="display: none">package middleware

import (
        "tugas-pertemuan-7/utils"

        "github.com/gofiber/fiber/v2"
)

func Jwt(c *fiber.Ctx) error <span class="cov0" title="0">{
        authHeader := c.Get("Authorization")

        if authHeader == "" </span><span class="cov0" title="0">{
                return fiber.NewError(fiber.StatusUnauthorized, "Authorization header is required")
        }</span>

        <span class="cov0" title="0">claims, err := utils.ParseJwt(authHeader)

        if err != nil </span><span class="cov0" title="0">{
                return fiber.NewError(fiber.StatusUnauthorized, err.Error())
        }</span>

        <span class="cov0" title="0">c.Locals("id", claims.Id)
        c.Locals("username", claims.Username)
        c.Locals("role", claims.Role)

        return c.Next()</span>
}
</pre>
		
		<pre class="file" id="file6" style="display: none">package tests

import (
        "tugas-pertemuan-7/handlers"
        "tugas-pertemuan-7/middleware"

        "github.com/gofiber/fiber/v2"
)

func SetupTestApp() *fiber.App <span class="cov0" title="0">{
        app := fiber.New()

        app.Post("/api/auth/login", handlers.Login)

        app.Get("/api/students", middleware.Jwt, handlers.GetStudents)
        app.Get("/api/students/:id", middleware.Jwt, handlers.GetStudent)

        return app
}</span>
</pre>
		
		<pre class="file" id="file7" style="display: none">package utils

import (
        "errors"
        "os"
        "tugas-pertemuan-7/models"

        "github.com/golang-jwt/jwt/v5"

        "time"

        _ "tugas-pertemuan-7/docs"
)

type Claims struct {
        Id       int    `json:"id"`
        Username string `json:"username"`
        Role     string `json:"role"`
        jwt.RegisteredClaims
}

func CreateJwt(data *models.User) (string, error) <span class="cov8" title="1">{
        claims := Claims{
                Id:       data.ID,
                Username: data.Username,
                Role:     data.Role,
                RegisteredClaims: jwt.RegisteredClaims{
                        ExpiresAt: jwt.NewNumericDate(time.Now().Add(24 * time.Hour)),
                        IssuedAt:  jwt.NewNumericDate(time.Now()),
                },
        }

        token := jwt.NewWithClaims(jwt.SigningMethodHS256, claims)

        return token.SignedString([]byte(os.Getenv("JWT_SECRET")))
}</span>

func ParseJwt(authHeader string) (*Claims, error) <span class="cov8" title="1">{
        var tokenString string

        if len(authHeader) &gt; 7 &amp;&amp; authHeader[:7] == "Bearer " </span><span class="cov8" title="1">{
                tokenString = authHeader[7:]
        }</span>

        <span class="cov8" title="1">token, err := jwt.ParseWithClaims(
                tokenString,
                &amp;Claims{},
                func(t *jwt.Token) (any, error) </span><span class="cov8" title="1">{
                        return []byte(os.Getenv("JWT_SECRET")), nil
                }</span>,
        )

        <span class="cov8" title="1">if err != nil || !token.Valid </span><span class="cov8" title="1">{
                return nil, errors.New("Invalid or expired token")
        }</span>

        <span class="cov8" title="1">claims, ok := token.Claims.(*Claims)

        if !ok </span><span class="cov0" title="0">{
                return nil, errors.New("Invalid token claims")
        }</span>

        <span class="cov8" title="1">return claims, nil</span>
}
</pre>
		
		<pre class="file" id="file8" style="display: none">package utils

import (
        "net/mail"
)

func ValidateEmail(email string) bool <span class="cov8" title="1">{
        _, err := mail.ParseAddress(email)
        return err == nil
}</span>

func ValidateNIM(nim string) bool <span class="cov8" title="1">{
        return nim != ""
}</span>

func ValidateSemester(semester int) bool <span class="cov8" title="1">{
        return semester &gt; 0
}</span>
</pre>
		
		</div>
	</body>
	<script>
	(function() {
		var files = document.getElementById('files');
		var visible;
		files.addEventListener('change', onChange, false);
		function select(part) {
			if (visible)
				visible.style.display = 'none';
			visible = document.getElementById(part);
			if (!visible)
				return;
			files.value = part;
			visible.style.display = 'block';
			location.hash = part;
		}
		function onChange() {
			select(files.value);
			window.scrollTo(0, 0);
		}
		if (location.hash != "") {
			select(location.hash.substr(1));
		}
		if (!visible) {
			select("file0");
		}
	})();
	</script>
</html>
